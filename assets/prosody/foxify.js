const neofoxos = ["neofox", "neofox_0_0", "neofox_3c", "neofox_amogus", "neofox_angel", "neofox_angel_pleading", "neofox_angry", "neofox_approve", "neofox_astronaut", "neofox_astronaut_gun", "neofox_aww", "neofox_baa", "neofox_blank", "neofox_blep", "neofox_blush", "neofox_blush_hide", "neofox_bongo_down", "neofox_bongo_up", "neofox_book", "neofox_book_owo", "neofox_boop", "neofox_boop_blep", "neofox_boop_blush", "neofox_boop_cute", "neofox_boop_googly", "neofox_boop_happy", "neofox_boop_nervous", "neofox_boop_owo", "neofox_boop_woozy", "neofox_bottom", "neofox_box", "neofox_catmask", "neofox_catmode", "neofox_cofe", "neofox_comfy", "neofox_comfy_happy", "neofox_comfy_mug", "neofox_comfy_sip", "neofox_comfy__w_", "neofox_confused", "neofox_cool", "neofox_cool_fingerguns", "neofox_cry", "neofox_cry_loud", "neofox_cute", "neofox_cute_reach", "neofox_devil", "neofox_dizzy", "neofox_drowsy", "neofox_evil", "neofox_evil_3c", "neofox_facepalm", "neofox_fingerguns", "neofox_flag_ace", "neofox_flag_agender", "neofox_flag_ambiamorous", "neofox_flag_androgyne", "neofox_flag_aro", "neofox_flag_aroflux", "neofox_flag_bi", "neofox_flag_bigender", "neofox_flag_demiace", "neofox_flag_demiaro", "neofox_flag_demiflux", "neofox_flag_demigirl", "neofox_flag_demiguy", "neofox_flag_demilesbian", "neofox_flag_deminb", "neofox_flag_disabled", "neofox_flag_finsexual", "neofox_flag_gay", "neofox_flag_genderfluid", "neofox_flag_intersex", "neofox_flag_lesbian", "neofox_flag_nb", "neofox_flag_pan", "neofox_flag_plural", "neofox_flag_polyam", "neofox_flag_salmacian", "neofox_flag_sapphic", "neofox_flag_trans", "neofox_floof", "neofox_floof_angel", "neofox_floof_cute", "neofox_floof_devil", "neofox_floof_happy", "neofox_floof_mug", "neofox_floof_owo", "neofox_floof_reach", "neofox_floof_sad", "neofox_floof_sad_reach", "neofox_floof__w_", "neofox_flop", "neofox_flop_blep", "neofox_flop_happy", "neofox_flop_sleep", "neofox_flop__w_", "neofox_flush", "neofox_glare", "neofox_glare_sob", "neofox_glasses", "neofox_googly", "neofox_googly_blep", "neofox_googly_drool", "neofox_googly_shocked", "neofox_googly_woozy", "neofox_gun", "neofox_happy", "neofox_happy_blep", "neofox_heart", "neofox_hug", "neofox_hug_blob", "neofox_hug_blob_heart", "neofox_hug_blob_sad", "neofox_hug_bun", "neofox_hug_bun_heart", "neofox_hug_bun_sad", "neofox_hug_cat", "neofox_hug_cat_heart", "neofox_hug_cat_sad", "neofox_hug_dragn", "neofox_hug_dragn_alt", "neofox_hug_dragn_heart", "neofox_hug_dragn_sad", "neofox_hug_dragn_sad_alt", "neofox_hug_duck", "neofox_hug_duck_heart", "neofox_hug_duck_sad", "neofox_hug_haj", "neofox_hug_haj_heart", "neofox_hug_haj_sad", "neofox_hug_heart", "neofox_hug_sad", "neofox_hyper", "neofox_kirby", "neofox_kirby_succ", "neofox_kisser", "neofox_knife", "neofox_knives", "neofox_laptop", "neofox_laptop_notice", "neofox_laptop_owo", "neofox_laugh", "neofox_laugh_nervous", "neofox_laugh_sweat", "neofox_laugh_tears", "neofox_lul", "neofox_magnify", "neofox_melt", "neofox_melt_2", "neofox_melt_3", "neofox_melt_blep", "neofox_melt_blush", "neofox_melt_happy", "neofox_melt_reach", "neofox_melt_sob", "neofox_melt_sob_heart", "neofox_mug", "neofox_mug_drink", "neofox_mug_owo", "neofox_mug__w_", "neofox_nervous", "neofox_nom_blob", "neofox_nom_blob_nervous", "neofox_nom_bread", "neofox_nom_bun", "neofox_nom_bun_nervous", "neofox_nom_burger", "neofox_nom_cat", "neofox_nom_cat_nervous", "neofox_nom_cookie", "neofox_nom_donut", "neofox_nom_dragn", "neofox_nom_dragn_nervous", "neofox_nom_egg", "neofox_nom_fox", "neofox_nom_fox_nervous", "neofox_nom_haj", "neofox_nom_haj_nervous", "neofox_nom_melon", "neofox_nom_pita", "neofox_nom_pizza", "neofox_nom_toblerone", "neofox_nom_verified", "neofox_nom_waffle", "neofox_notice", "neofox_owo", "neofox_owo_blep", "neofox_o_o", "neofox_pat", "neofox_pat_floof", "neofox_pat_flop", "neofox_pat_googly", "neofox_pat_happy", "neofox_pat_sad", "neofox_pat_snug", "neofox_pat_sob", "neofox_pat_up", "neofox_pat_woozy", "neofox_peek", "neofox_peek_bread", "neofox_peek_comfy", "neofox_peek_knife", "neofox_peek_owo", "neofox_pensive", "neofox_phone", "neofox_pleading", "neofox_pleading_reach", "neofox_police", "neofox_pout", "neofox_rainbow", "neofox_reach", "neofox_reach_drool", "neofox_reject", "neofox_sad", "neofox_sad_reach", "neofox_santa", "neofox_science", "neofox_scream", "neofox_scream_angry", "neofox_scream_scared", "neofox_scream_stare", "neofox_shocked", "neofox_shy", "neofox_sign_aaa", "neofox_sign_no", "neofox_sign_nya", "neofox_sign_thx", "neofox_sign_yes", "neofox_sign_yip", "neofox_sip", "neofox_sip_glare", "neofox_sip_nervous", "neofox_sip_owo", "neofox_smol", "neofox_smug", "neofox_snug", "neofox_snuggle", "neofox_snuggle_cat", "neofox_snug_glare", "neofox_snug_nervous", "neofox_snug_owo", "neofox_sob", "neofox_solder", "neofox_solder_googly", "neofox_stretch_dl", "neofox_stretch_down", "neofox_stretch_down_end", "neofox_stretch_dr", "neofox_stretch_h", "neofox_stretch_left", "neofox_stretch_right", "neofox_stretch_ul", "neofox_stretch_up", "neofox_stretch_ur", "neofox_stretch_v", "neofox_surprised", "neofox_surprised_pika", "neofox_sweat", "neofox_thief", "neofox_think", "neofox_thinking", "neofox_think_anime", "neofox_think_cool", "neofox_think_googly", "neofox_think_owo", "neofox_think_woozy", "neofox_thonk", "neofox_thumbsdown", "neofox_thumbsup", "neofox_up", "neofox_up_paws", "neofox_up_sleep", "neofox_up__w_", "neofox_uwu", "neofox_verified", "neofox_vr", "neofox_what", "neofox_wink", "neofox_wink_blep", "neofox_woozy", "neofox_x_x", "neofox_yeet", "neofox_yell", "neofox__w_", "waf"];
const funnyfoxxos = neofoxos.map(name => name.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'));
const pattern = ":(" + funnyfoxxos.join("|") + "):";
const regex = new RegExp(pattern, "g");
let enabled = true;
let blockedgoobs = "";
async function bigfetchonce(){
    const respon = await fetch("https://skydevs.me/assets/neofox/blacklist.txt");
    blockedgoobs = await respon.text();
    console.log("Fetched blocklist! :D");
}
bigfetchonce();
async function walk(node) {
  let child, next;
    switch (node.nodeType) {
        case 1:
        case 9:
        case 11:
            child = node.firstChild;
            while (child) {
                next = child.nextSibling;
                walk(child);
                child = next;
            }
            break;
        case 3:
            await handleText(node);
            break;
    }
}

async function blocklist() {
    console.log(blockedgoobs);
    for (const site of blockedgoobs.split("\n")) {
        if (window.location.href.includes(site.trim())) {
            console.log(window.location.href);
            console.log(blockedgoobs);
            return true;
        }
    }
    console.log("False");
    return false;
}

async function handleText(textNode) {
    let gooberdoo = "";
    for (const image of neofoxos) {
        if (textNode.nodeValue.includes(image)) {
            const supergoo = image + "_";
            if (textNode.nodeValue.includes(supergoo)) {
                if (image.includes(supergoo)) {
                    gooberdoo = image;
                    console.log(image);
                    console.log("Big goo")
                    break;
                }
            } else {
                gooberdoo = image;
                console.log(image);
                break;
            }
        }
    }
    const match = textNode.nodeValue.match(regex);
    if (match && !(await blocklist()) && enabled) {
        const img = document.createElement("img");
        img.src = `https://skydevs.me/assets/neofox/${gooberdoo}.png`;
        img.width = 25;
        img.height = 25;
        img.classList.add("neofox")
        img.alt = gooberdoo
        const parts = textNode.nodeValue.split(match[0]);
        const fragment = document.createDocumentFragment();
        fragment.appendChild(document.createTextNode(parts[0]));
        fragment.appendChild(img);
        fragment.appendChild(document.createTextNode(parts[1] || ""));
        textNode.parentNode.replaceChild(fragment, textNode);
    }
}

function togglestat() {
    enabled = !enabled;
}

chrome.runtime.onMessage.addListener((request, sender, sendResponse) => {
    if (request.action === "togglestat") {
        togglestat();
        sendResponse({ reply: enabled ? "Enabled" : "Disabled" });
        return true;
    }
});

chrome.runtime.onMessage.addListener((request, sender, sendResponse) => {
    if (request.action === "readit") {
        sendResponse({ reply: enabled ? "Enabled" : "Disabled" });
        return true;
    }
});

function goobs() {
    walk(document.body);
}
walk(document.body);
setInterval(async function() { await walk(document.body); }, 1000); // Adjust this if needed (I don't want my site getting pinged every second by multiple clients so if you do decrease this value please host some of the assets on your site :P)
